<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracking System</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- --- MERGED STYLES START --- -->
    <style>
        /* --- Color Variables --- */
        :root {
            --color-bg-dark: #111827;
            --color-bg-card: #273041;
            --color-bg-light-card: #37475a;
            --color-text-light: #f3f4f6;
            --color-text-secondary: #a0aec0;
            --color-border: #4a5568;
            --color-accent-pink: #ff6e96;
            --color-accent-green: #00e0b3;
            --color-accent-red: #ff5252;
            --color-accent-indigo: #7986cb;
            --color-success: #00e0b3;
            --color-error: #ff5252;
        }
        /* --- Global & Base Styles --- */
        .app-body { background-color: var(--color-bg-dark); color: var(--color-text-light); font-family: 'Inter', sans-serif; min-height: 100vh; padding: 1.5rem; line-height: 1.5; }
        .container { max-width: 56rem; margin-left: auto; margin-right: auto; }
        .app-spacing { margin-top: 1.5rem; margin-bottom: 1.5rem; }
        .transition-slow { transition: opacity 300ms ease-in-out; }
        .message-container { position: fixed; top: 0; left: 0; right: 0; z-index: 50; padding: 1rem; max-width: 28rem; margin-left: auto; margin-right: auto; pointer-events: none; }
        /* --- Card & Section Styles --- */
        .app-card { background-color: var(--color-bg-card); border: 1px solid var(--color-border); border-radius: 0.75rem; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6); padding: 1.5rem; margin-bottom: 1.5rem; }
        .header-shadow { box-shadow: 0 6px 12px rgba(255, 110, 150, 0.2); }
        .card-subtle { padding: 0.75rem; background-color: var(--color-bg-light-card); border-radius: 0.5rem; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4); }
        .app-header { background-color: var(--color-bg-card); padding: 1.5rem; border-bottom: 4px solid var(--color-accent-pink); border-radius: 0.75rem; margin-bottom: 1.5rem; text-align: center; }
        .header-title { color: var(--color-accent-pink); font-weight: 800; font-size: 1.875rem; }
        .header-subtitle { color: var(--color-text-secondary); margin-top: 0.25rem; }
        .section-title { color: var(--color-text-light); font-weight: 600; font-size: 1.25rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.5rem; margin-bottom: 1rem; }
        /* --- Layouts & Inputs --- */
        .flex-row-group { display: flex; gap: 1rem; margin-top: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .flex-1 { flex: 1 1 0%; }
        .hidden { display: none !important; }
        .grid-col-2-group { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 0.75rem; }
        .metrics-grid { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 1rem; padding-top: 0.5rem; border-top: 1px solid var(--color-border); margin-top: 1rem; }
        .input-label { display: block; color: var(--color-text-secondary); margin-bottom: 0.25rem; }
        .app-select { width: 100%; background-color: var(--color-bg-light-card); color: var(--color-text-light); padding: 0.5rem; border-radius: 0.5rem; border: 1px solid var(--color-border); appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23a0aec0'%3E%3Cpath d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em; }
        .scanner-input { width: 100%; font-size: 1.125rem; color: var(--color-accent-pink); background-color: var(--color-bg-dark); border: 4px solid var(--color-bg-light-card); border-radius: 0.75rem; padding: 0.75rem; text-align: center; transition: border-color 200ms, box-shadow 200ms; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6); }
        .scanner-input:focus { border-color: var(--color-accent-pink); outline: none; box-shadow: 0 0 10px rgba(255, 110, 150, 0.5); }
        .scanning-error::placeholder { color: var(--color-error); opacity: 1; }
        .app-textarea { width: 100%; height: 8rem; background-color: var(--color-bg-dark); color: var(--color-text-light); padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--color-border); font-size: 0.875rem; resize: vertical; }
        .mode-button { flex: 1; padding: 0.75rem 1.5rem; border-radius: 0.5rem; color: white; font-weight: bold; transition: background-color 150ms, transform 150ms, box-shadow 150ms; border: none; cursor: pointer; box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4); }
        .mode-button:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
        .mode-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0, 0, 0, 0.6); }
        .btn-pill { border-radius: 9999px; padding: 0.9rem 2rem; }
        .btn-neutral { background-color: var(--color-bg-light-card); }
        .hover-green:hover { background-color: var(--color-success); }
        .hover-red:hover { background-color: var(--color-error); }
        .accent-green { background-color: var(--color-success); }
        .accent-red { background-color: var(--color-error); }
        .bg-blue-600 { background-color: #2563eb; } .bg-purple-600 { background-color: #9333ea; } .bg-indigo-600 { background-color: #4f46e5; } .bg-yellow-600 { background-color: #ca8a04; } .bg-red-800 { background-color: #991b1b; }
        .hover-blue:hover { background-color: #1d4ed8; } .hover-purple:hover { background-color: #7e22ce; } .hover-indigo:hover { background-color: #4338ca; } .hover-yellow:hover { background-color: #a16207; } .hover-red-dark:hover { background-color: #7f1d1d; }
        /* --- Status & Table Styles --- */
        .status-box { text-align: center; padding: 0.5rem; border-radius: 0.25rem; background-color: #4b5563; color: var(--color-text-light); font-size: 0.875rem; font-weight: 600; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4); }
        .data-table { min-width: 100%; font-size: 0.875rem; border-collapse: collapse; }
        .table-header-row { color: var(--color-accent-pink); background-color: var(--color-bg-light-card); }
        .table-header-cell { padding: 0.5rem 0.75rem; text-align: left; font-weight: 600; }
        .data-table tbody tr:hover { background-color: var(--color-bg-light-card); }
        /* --- Accent Text Colors --- */
        .text-accent-green { color: var(--color-accent-green); } .text-accent-pink { color: var(--color-accent-pink); } .text-accent-red { color: var(--color-accent-red); } .text-accent-indigo { color: var(--color-accent-indigo); }
        .metric-value { font-size: 1.5rem; font-weight: 800; }
        .metric-label { font-size: 0.75rem; color: var(--color-text-secondary); }
        /* --- Animations & Effects --- */
        @keyframes action-glow { 0% { box-shadow: 0 0 0 0 rgba(0, 224, 179, 0.7); } 50% { box-shadow: 0 0 0 15px rgba(0, 224, 179, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 224, 179, 0.7); } }
        .btn-action-glow { animation: action-glow 2s ease-in-out infinite; }
        @keyframes scanning-pulse { 0% { border-color: var(--color-accent-pink); box-shadow: 0 0 10px rgba(255, 110, 150, 0.7); } 50% { border-color: var(--color-accent-red); box-shadow: 0 0 20px rgba(255, 82, 82, 0.9); } 100% { border-color: var(--color-accent-pink); box-shadow: 0 0 10px rgba(255, 110, 150, 0.7); } }
        .scanner-input.scanning-active { animation: scanning-pulse 1s ease-in-out infinite alternate; }
        /* --- Responsive Design --- */
        @media (max-width: 768px) { .metrics-grid { grid-template-columns: 1fr 1fr; } .flex-row-group { flex-direction: column; } .grid-col-2-group { grid-template-columns: 1fr; } .header-title { font-size: 1.5rem; } .app-header { padding: 1rem; } }
    </style>
</head>
<body class="app-body">

<div id="messageContainer" class="message-container"></div>
<div class="container app-spacing">
    <header class="app-header header-shadow">
        <h1 class="header-title">üß§ PROGLOVE BOWL TRACKING</h1>
        <p class="header-subtitle">Real-time Prep & Return Synchronization</p>
    </header>

    <section class="app-card" id="modeSelectionCard">
        <h2 class="section-title">1. Select Operation Mode</h2>
        <div class="flex-row-group">
            <button id="kitchenBtn" onclick="setMode('kitchen')" class="mode-button btn-neutral hover-green">üç≥ KITCHEN PREP</button>
            <button id="returnBtn" onclick="setMode('return')" class="mode-button btn-neutral hover-red">üîÑ RETURN SCAN</button>
        </div>
        <div id="modeDisplay" class="status-box">Status: Please Select Mode</div> 
    </section>

    <section class="app-card" id="userSelectionCard" style="opacity: 0.5; transition: opacity 300ms ease-in-out;">
        <h2 class="section-title">2. Select User & Dish</h2>
        <div class="flex-row-group">
            <div class="flex-1">
                <label for="userSelect" class="input-label">User Name</label>
                <select id="userSelect" onchange="selectUser(this.value)" class="app-select" disabled>
                    <option value="" disabled selected>-- Select User --</option>
                </select>
            </div>
            <div class="flex-1 hidden" id="dishSection"> 
                <label for="dishLetterSelect" class="input-label">Dish Letter (A-Z / 1-4)</label>
                <select id="dishLetterSelect" onchange="selectDishLetter(this.value)" class="app-select" disabled>
                    <option value="" disabled selected>-- Select Dish --</option>
                </select>
            </div>
        </div>
    </section>

    <section class="app-card" id="scanningCard" style="opacity: 0.5; transition: opacity 300ms ease-in-out;">
        <h2 class="section-title">3. Scanner Input</h2>
        <div class="flex-row-group">
            <button id="startBtn" onclick="startScanning()" class="mode-button btn-pill accent-green" disabled>‚ñ∂ START SCANNER</button>
            <button id="stopBtn" onclick="stopScanning()" class="mode-button btn-pill accent-red" disabled>‚èπ STOP SCANNER</button>
        </div>
        <div class="relative mt-4">
            <input type="text" id="scanInput" placeholder="Select User and Press START..." class="scanner-input" disabled autocomplete="off">
            <p id="responseTimeValue" style="position: absolute; right: 0.5rem; top: 0.5rem; color: var(--color-text-secondary); font-size: 0.75rem;"></p>
        </div>
        <div class="metrics-grid">
            <div class="card-subtle">
                <p class="metric-label">User Scans (<span id="myDishLetterLabel">---</span>)</p>
                <p id="myScansCount" class="metric-value text-accent-green">0</p>
            </div>
            <div class="card-subtle">
                <p class="metric-label">Prepared Today</p>
                <p id="preparedTodayCount" class="metric-value text-accent-pink">0</p>
            </div>
            <div class="card-subtle">
                <p class="metric-label">Active (Out)</p>
                <p id="activeCount" class="metric-value text-accent-red">0</p>
            </div>
            <div class="card-subtle">
                <p class="metric-label">Returned Total</p>
                <p id="exportReturnCount" class="metric-value text-accent-indigo">0</p>
            </div>
        </div>
    </section>

    <section class="app-card">
        <h2 class="section-title">Live Prep Report (10 PM Cycle)</h2>
        <div>
            <table class="data-table">
                <thead>
                    <tr class="table-header-row">
                        <th class="table-header-cell">Dish</th>
                        <th class="table-header-cell">User</th>
                        <th class="table-header-cell">Count</th>
                    </tr>
                </thead>
                <tbody id="livePrepReportBody">
                    <tr><td colspan="3" class="table-empty-cell">No kitchen scans recorded during this cycle.</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="app-card">
        <h2 class="section-title">Data Management & Export</h2>
        <p id="lastSyncInfo">Awaiting sync...</p> 
        <div class="grid-col-2-group">
            <button onclick="exportActiveBowls()" class="mode-button bg-blue-600 hover-blue">üì• Export Active Bowls</button>
            <button onclick="exportReturnData()" class="mode-button bg-purple-600 hover-purple">üì• Export Returns</button>
            <button onclick="exportAllData()" class="mode-button bg-indigo-600 hover-indigo" style="grid-column: span 2;">üìä Export ALL Data</button>
        </div>
        <div style="border-top: 1px solid var(--color-border); padding-top: 1rem; margin-top: 1rem;">
            <h3 class="input-label">JSON Import (Customer Data Patch)</h3>
            <textarea id="jsonData" placeholder='Paste JSON data here...' class="app-textarea"></textarea>
            <div class="flex-row-group">
                <button onclick="processJSONData(document.getElementById('jsonData').value)" class="mode-button bg-yellow-600 hover-yellow">üîÑ Patch Customer Data</button>
                <button onclick="resetTodaysPreparedBowls()" class="mode-button bg-red-800 hover-red-dark">üóëÔ∏è Reset Prepared/Scans</button>
            </div>
            <div id="patchResults" style="display: none; margin-top: 10px;">
                <p id="patchSummary" class="text-accent-pink"></p>
                <p id="failedMatches" class="text-accent-red"></p>
                <p id="jsonStatus" class="text-accent-green"></p>
            </div>
        </div>
    </section>
</div>

<!-- SCRIPT IS LOADED ONCE AT THE END -->
<script src="app-logic.js"></script> 

</body>
</html>
